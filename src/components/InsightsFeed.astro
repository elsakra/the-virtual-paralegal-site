---
import { getCollection } from 'astro:content';

interface Props {
  headline?: string;
  limit?: number;
}

const { headline = "Latest insights", limit = 5 } = Astro.props;

const posts = await getCollection('blog');
const sortedPosts = posts
  .sort((a, b) => {
    const dateA = new Date(a.data.date || a.data.publishedAt || '1970-01-01');
    const dateB = new Date(b.data.date || b.data.publishedAt || '1970-01-01');
    return dateB.getTime() - dateA.getTime();
  })
  .slice(0, limit);

function getTypeColor(type?: string) {
  switch(type?.toLowerCase()) {
    case 'alert': return 'bg-primary-500 text-white';
    case 'press': 
    case 'press release': return 'bg-charcoal-900 text-white';
    case 'article': return 'bg-primary-500/10 text-primary-600';
    default: return 'bg-neutral-100 text-charcoal-700';
  }
}
---

<section class="bg-white py-28 lg:py-36">
  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    <div class="mb-16 flex flex-col lg:flex-row lg:items-end lg:justify-between gap-8" data-reveal>
      <div>
        <span class="section-label">Insights</span>
        <h2 class="headline-lg text-4xl sm:text-5xl lg:text-6xl text-charcoal-950 mt-6">{headline}</h2>
      </div>
      <a href="/blog" class="inline-flex items-center gap-2 text-primary-500 font-semibold text-lg link-underline hover:gap-3 transition-all">
        View all insights
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
    
    <div class="space-y-0" data-reveal-stagger>
      {sortedPosts.map((post, idx) => (
        <a 
          href={`/blog/${post.slug}`}
          class="group block py-8 lg:py-10 border-b border-neutral-200 hover:bg-neutral-50/50 -mx-6 px-6 transition-all"
        >
          <div class="flex flex-col lg:flex-row lg:items-center gap-6 lg:gap-10">
            <!-- Editorial number -->
            <div class="font-display text-5xl lg:text-6xl text-primary-500/20 group-hover:text-primary-500/40 transition-colors w-20 flex-shrink-0">
              {String(idx + 1).padStart(2, '0')}
            </div>
            
            <div class="flex-1 min-w-0">
              <h3 class="font-display text-2xl md:text-3xl lg:text-4xl text-charcoal-950 group-hover:text-primary-600 transition-colors leading-tight">
                {post.data.title}
              </h3>
              {post.data.excerpt && (
                <p class="mt-4 text-neutral-600 text-lg leading-relaxed max-w-3xl line-clamp-2">
                  {post.data.excerpt}
                </p>
              )}
            </div>
            
            <div class="flex items-center gap-5 flex-shrink-0">
              {post.data.type && (
                <span class:list={[
                  "px-4 py-1.5 text-xs font-semibold uppercase tracking-wider rounded-full",
                  getTypeColor(post.data.type)
                ]}>
                  {post.data.type}
                </span>
              )}
              <div class="w-12 h-12 rounded-full border-2 border-neutral-200 group-hover:border-primary-500 group-hover:bg-primary-500 flex items-center justify-center transition-all">
                <svg class="w-5 h-5 text-neutral-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </div>
            </div>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>
