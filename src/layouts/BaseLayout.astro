---
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import siteData from '@/data/site.json';

interface Props {
  title?: string;
  description?: string;
  lightHero?: boolean;
}

const { title, description, lightHero = false } = Astro.props;
const pageTitle = title ? `${title} | ${siteData.company.name}` : siteData.seo.title;
const pageDescription = description || siteData.seo.description;

// Extract brand color (defaults to navy for professional services)
const primaryColor = siteData.branding?.primaryColor || '#1e3a5f';
// Generate color shades from the primary color
const hexToRgb = (hex: string) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : { r: 30, g: 58, b: 95 };
};
const rgb = hexToRgb(primaryColor);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={pageDescription} />
    <title>{pageTitle}</title>
    
    <!-- Fonts: Playfair Display for headlines, Inter for body -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Favicon - use logo if it's a CDN URL, otherwise fallback to static -->
    {siteData.branding?.logo?.includes('cloudinary') || siteData.branding?.logo?.includes('http') ? (
      <link rel="icon" type="image/png" href={siteData.branding.logo} />
    ) : (
      <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    )}
    
    <!-- Dynamic brand colors from site.json -->
    <style define:vars={{ 
      'brand-primary': primaryColor,
      'brand-rgb': `${rgb.r}, ${rgb.g}, ${rgb.b}`
    }}>
      :root {
        --brand-primary: var(--brand-primary);
        --brand-rgb: var(--brand-rgb);
      }
    </style>
  </head>
  <body class="bg-white text-charcoal-950 font-body antialiased text-lg leading-relaxed">
    <Header lightHero={lightHero} />
    <main>
      <slot />
    </main>
    <Footer />
  </body>
</html>

<style is:global>
  html {
    scroll-behavior: smooth;
  }
  
  /* Disable ligatures to prevent font rendering issues */
  * {
    font-feature-settings: "liga" 0, "clig" 0, "dlig" 0, "hlig" 0;
    -webkit-font-feature-settings: "liga" 0, "clig" 0, "dlig" 0, "hlig" 0;
    -moz-font-feature-settings: "liga" 0, "clig" 0, "dlig" 0, "hlig" 0;
    font-variant-ligatures: none;
    -webkit-font-variant-ligatures: none;
  }
  
  .font-display {
    font-family: 'Playfair Display', Georgia, serif;
  }
  
  .font-body {
    font-family: 'Inter', system-ui, sans-serif;
  }

  body {
    letter-spacing: -0.01em;
  }
  
  /* Selection color - navy blue */
  ::selection {
    background-color: rgba(30, 58, 95, 0.2);
    color: #18181B;
  }

  /* =========================================================================
     TYPOGRAPHY SYSTEM - Editorial Warmth
     ========================================================================= */
  
  /* Section label with accent bar */
  .section-label {
    display: inline-flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: #9ca3af;
  }
  
  .section-label::before {
    content: '';
    width: 2.5rem;
    height: 3px;
    background: var(--brand-primary, #1e3a5f);
  }
  
  /* Display headlines - editorial tight tracking */
  .headline-xl {
    font-family: 'Playfair Display', Georgia, serif;
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 0.95;
  }
  
  .headline-lg {
    font-family: 'Playfair Display', Georgia, serif;
    font-weight: 600;
    letter-spacing: -0.02em;
    line-height: 1.05;
  }
  
  /* Accent divider line */
  .accent-divider {
    width: 60px;
    height: 3px;
    background: var(--brand-primary, #1e3a5f);
  }
  
  /* Large decorative number for lists */
  .editorial-number {
    font-family: 'Playfair Display', Georgia, serif;
    font-weight: 400;
    color: rgba(var(--brand-rgb), 0.15);
    font-size: 5rem;
    line-height: 1;
    letter-spacing: -0.05em;
  }

  /* Section divider with gradient */
  .section-divider {
    height: 1px;
    background: linear-gradient(
      to right,
      transparent,
      rgba(var(--brand-rgb), 0.3),
      transparent
    );
  }
  
  /* Decorative dots pattern */
  .dots-pattern {
    background-image: radial-gradient(
      rgba(var(--brand-rgb), 0.1) 1px,
      transparent 1px
    );
    background-size: 20px 20px;
  }
  
  /* Corner accent decoration */
  .corner-accent::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 60px;
    height: 60px;
    border-left: 3px solid var(--brand-primary, #1e3a5f);
    border-top: 3px solid var(--brand-primary, #1e3a5f);
    opacity: 0.3;
  }
  
  /* Gradient text effect */
  .gradient-text {
    background: linear-gradient(
      135deg,
      #ffffff 0%,
      rgba(var(--brand-rgb), 0.8) 50%,
      #ffffff 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* =========================================================================
     WOW FACTOR ANIMATIONS - Scroll Reveals
     ========================================================================= */
  
  /* Scroll reveal base - elements start hidden */
  [data-reveal] {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), 
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  [data-reveal].revealed {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Staggered children - add delays */
  [data-reveal-stagger] > * {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1), 
                transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  [data-reveal-stagger].revealed > *:nth-child(1) { transition-delay: 0ms; }
  [data-reveal-stagger].revealed > *:nth-child(2) { transition-delay: 80ms; }
  [data-reveal-stagger].revealed > *:nth-child(3) { transition-delay: 160ms; }
  [data-reveal-stagger].revealed > *:nth-child(4) { transition-delay: 240ms; }
  [data-reveal-stagger].revealed > *:nth-child(5) { transition-delay: 320ms; }
  [data-reveal-stagger].revealed > *:nth-child(6) { transition-delay: 400ms; }
  
  [data-reveal-stagger].revealed > * {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Slide from left */
  [data-reveal="left"] {
    transform: translateX(-40px);
  }
  [data-reveal="left"].revealed {
    transform: translateX(0);
  }
  
  /* Slide from right */
  [data-reveal="right"] {
    transform: translateX(40px);
  }
  [data-reveal="right"].revealed {
    transform: translateX(0);
  }
  
  /* Scale up */
  [data-reveal="scale"] {
    transform: scale(0.95);
  }
  [data-reveal="scale"].revealed {
    transform: scale(1);
  }

  /* =========================================================================
     MICRO-INTERACTIONS - Buttons & Cards
     ========================================================================= */
  
  /* Premium button hover - glow + lift */
  .btn-primary,
  a[class*="bg-primary"] {
    position: relative;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
                box-shadow 0.3s ease,
                background-color 0.2s ease;
  }
  
  .btn-primary:hover,
  a[class*="bg-primary"]:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 10px 40px -10px rgba(var(--brand-rgb), 0.5),
                0 4px 20px -8px rgba(0, 0, 0, 0.2);
  }
  
  .btn-primary:active,
  a[class*="bg-primary"]:active {
    transform: translateY(0) scale(0.98);
  }
  
  /* Card hover - lift with depth */
  .card-hover,
  [data-card] {
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                box-shadow 0.4s ease,
                border-color 0.3s ease;
  }
  
  .card-hover:hover,
  [data-card]:hover {
    transform: translateY(-8px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15),
                0 12px 24px -8px rgba(0, 0, 0, 0.1);
  }
  
  /* Card with left accent border - Cooley style */
  .card-accent {
    position: relative;
    border-left: 4px solid transparent;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .card-accent::before {
    content: '';
    position: absolute;
    left: -4px;
    top: 0;
    bottom: 0;
    width: 4px;
    background: var(--brand-primary, #1e3a5f);
    transform: scaleY(0);
    transform-origin: bottom;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .card-accent:hover::before {
    transform: scaleY(1);
  }
  
  .card-accent:hover {
    border-left-color: var(--brand-primary, #1e3a5f);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.1);
  }
  
  /* Link underline animation */
  .link-underline {
    position: relative;
    text-decoration: none;
  }
  
  .link-underline::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: currentColor;
    transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  .link-underline:hover::after {
    width: 100%;
  }

  /* =========================================================================
     CINEMATIC EFFECTS - Grain & Light Sweep
     ========================================================================= */
  
  /* Animated film grain overlay */
  .grain-overlay::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.03;
    pointer-events: none;
    animation: grain 8s steps(10) infinite;
  }
  
  @keyframes grain {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-5%, -10%); }
    20% { transform: translate(-15%, 5%); }
    30% { transform: translate(7%, -25%); }
    40% { transform: translate(-5%, 25%); }
    50% { transform: translate(-15%, 10%); }
    60% { transform: translate(15%, 0%); }
    70% { transform: translate(0%, 15%); }
    80% { transform: translate(3%, 35%); }
    90% { transform: translate(-10%, 10%); }
  }
  
  /* Light sweep effect for headlines */
  .light-sweep {
    position: relative;
    overflow: hidden;
  }
  
  .light-sweep::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.1),
      transparent
    );
    animation: sweep 4s ease-in-out infinite;
    animation-delay: 2s;
  }
  
  @keyframes sweep {
    0% { left: -100%; }
    50%, 100% { left: 200%; }
  }
  
  /* Gradient shift animation */
  .gradient-shift {
    background-size: 200% 200%;
    animation: gradient-move 15s ease infinite;
  }
  
  @keyframes gradient-move {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  
  /* Subtle parallax helper */
  .parallax-slow {
    will-change: transform;
  }

  /* =========================================================================
     IMAGE REVEAL - Mask animation
     ========================================================================= */
  
  [data-image-reveal] {
    position: relative;
    overflow: hidden;
  }
  
  [data-image-reveal]::after {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--brand-primary, #1e3a5f);
    transform: scaleX(1);
    transform-origin: right;
    transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
  }
  
  [data-image-reveal].revealed::after {
    transform: scaleX(0);
  }
  
  [data-image-reveal] img {
    transform: scale(1.1);
    transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  [data-image-reveal].revealed img {
    transform: scale(1);
  }
</style>

<script>
  // Scroll reveal observer
  const revealElements = document.querySelectorAll('[data-reveal], [data-reveal-stagger], [data-image-reveal]');
  
  const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('revealed');
        revealObserver.unobserve(entry.target);
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  });
  
  revealElements.forEach(el => revealObserver.observe(el));
  
  // Subtle parallax on hero backgrounds
  const parallaxElements = document.querySelectorAll('.parallax-slow');
  
  if (parallaxElements.length > 0) {
    let ticking = false;
    
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const scrollY = window.scrollY;
          parallaxElements.forEach(el => {
            const speed = 0.3;
            (el as HTMLElement).style.transform = `translateY(${scrollY * speed}px)`;
          });
          ticking = false;
        });
        ticking = true;
      }
    });
  }
</script>
